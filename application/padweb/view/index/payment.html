{include file="common:header"}
<body>
<div class="order">
    <div id="carousel-example-generic" class="carousel slide swipper" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
            <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
            <li data-target="#carousel-example-generic" data-slide-to="1"></li>
            <li data-target="#carousel-example-generic" data-slide-to="2"></li>
        </ol>
        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox">
            <div class="item active">
                <img src="/static/assets/padweb/images/banner1.jpg" alt="...">
            </div>
            <div class="item">
                <img src="/static/assets/padweb/images/banner2.jpg" alt="...">
            </div>
            <div class="item">
                <img src="/static/assets/padweb/images/banner3.jpg" alt="...">
            </div>
        </div>
    </div>
    <div class="list-nav">
        <span class="nav-title" onclick="window.history.back(-1)">
            <img class="icon-back" src="/static/assets/padweb/images/back.png" alt="">返回</span>
    </div>
    <div class="order-title">確認訂單</div>
    <div>
        <ul class="list-ul">
            {volist name="show_order" id="vo" key="kk"}
            {if($vo.payType<3)}
            <li class="list-li line-wrapper">
                <div class="line-scroll-wrapper">
                    <div class="con line-normal-wrapper">
                        <img class="category-img" src="{$vo.thumbnailUrl}" alt="">
                        <div class="order-detail">
                            <div class="category-name">{$vo.name}{if(!empty($vo.weight))}[{$vo.weight}{$vo.payUnit}]{/if}{if(!empty($vo.specNames))}{$vo.specNames}{/if}
                            </div>
                            <div class="category-subtitle"><span class="order-num"></span></div>
                            <div class="price">HKD$<em class="price-num">{$vo.salePrice}</em></div>
                        </div>
                        <div class="order-num num">x{$vo.counter}</div>
                    </div>
                    <div class="line-btn-delete" onclick="orderDel('{$kk}')"><img src="/static/assets/padweb/images/btn-delete.png" alt="">删除</div>
                </div>
            </li>
            {else}
            <li class="list-li line-wrapper">
                <div class="line-scroll-wrapper">
                    <div class="con line-normal-wrapper">
                        <img class="category-img" src="{$vo.thumbnailUrl}" alt="">
                        <div class="order-detail">
                            <div class="category-name">{$vo.name}</div>
                            {volist name="vo._food" id="fo" key="k"}
                            <div class="category-subtitle">{$fo.name}{if(!empty($fo.weight))}[{$fo.weight}{$fo.payUnit}]{/if}{if(!empty($fo.specNames))}{$fo.specNames}{/if}</div>
                            {/volist}
                            <div class="price">HKD$<em class="price-num">{$vo.salePrice}</em></div>
                        </div>
                        <div class="order-num num">x{$fo.counter}</div>
                    </div>
                    <div class="line-btn-delete" onclick="orderDel('{$kk}')"><img src="/static/assets/padweb/images/btn-delete.png" alt="">删除</div>
                </div>
            </li>
            {/if}
            {/volist}
        </ul>
        <div class="order-content">
            <div class="total"><span class="total-name">小計</span><span class="order-num">HKD${$order.totalPrice}</span></div>
            <div class="total"><span class="total-name">合計</span><span class="price">HKD$<em class="price-num">{$order.totalPrice}</em></span></div>
        </div>
    </div>
    <div class="footer-btn">
        <button class="order-btn cancel order-cancel">取消订单</button>
        <button class="order-btn buried order-buried">埋单</button>
    </div>
    <div class="dialog">
        <div class="dialog-wrapper"></div>
        <div class="dialog-main">
            <div class="recommend-title">推<span>薦菜</span>品</div>
            <ul>
                <li class="recommend-li">
                    <img class="recommend-img" src="/static/assets/padweb/images/Bitmap.png" alt="">
                    <div class="recommend-category">
                        <div class="category-name recommend-name">低脂蛋白瘦身塑型營養健康早餐首選低脂蛋白瘦身塑型營養健康早餐首選
                        </div>
                        <div class="price recommend-price">HKD$<em class="price-num">34.50</em></div>
                        <div class="food-num">
                            <i class="fab-reduce"></i>
                            <span class="num-text"></span>
                            <i class="fab-add"></i>
                        </div>
                    </div>
                </li>
                <li class="recommend-li">
                    <img class="recommend-img" src="/static/assets/padweb/images/Bitmap.png" alt="">
                    <div class="recommend-category">
                        <div class="category-name recommend-name">低脂蛋白瘦身塑型營養健康早餐首選低脂蛋白瘦身塑型營養健康早餐首選
                        </div>
                        <div class="price recommend-price">HKD$<em class="price-num">34.50</em></div>
                        <div class="food-num">
                            <i class="fab-reduce"></i>
                            <span class="num-text"></span>
                            <i class="fab-add"></i>
                        </div>
                    </div>
                </li>
            </ul>
            <div>
                <button class="order-btn cancel recommend-cancel">不，谢谢</button>
                <button class="order-btn buried recommend-buried">加入訂單</button>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
    .order {
        background-color: #F6F8F8;
        height: 100vh;
        padding-bottom: 10%;
    }

    .swipper {
        height: 490px;
        width: 100%;
        overflow: hidden;
        display: block;
    }

    .carousel-indicators li {
        border: 1px solid #FF5901
    }

    .carousel-indicators .active {
        background-color: #FF5901;
    }

    .carousel-inner .item img{
        width: 100%;
        height: 100%;
    }

    .list-nav {
        display: table;
        width: 100%;
        text-align: right;
        padding: 20px 48px 25px;
        line-height: 30px;
        box-sizing: border-box;
    }

    .list-nav .icon-back {
        display: inline-block;
        width: 25px;
        height: 25px;
        margin-right: 5px;
        vertical-align: text-bottom;
    }

    .list-nav .nav-title {
        font-size: 20px;
        color: #000000;
        vertical-align: middle;
    }

    .order-title {
        border-left: 6px solid #FE6400;
        padding-left: 6px;
        font-size: 22px;
        color: #000;
        font-weight: normal;
        margin-left: 48px;
        margin-bottom: 20px;
    }

    .list-ul {
        overflow: scroll;
        max-height: 820px;
        overflow-x: hidden;
    }

    .list-li {
        position: relative;
        color: #000;
        background-color: #fff;
        width: 100%;
        border-bottom: 20px solid #f6f8f8;
    }

    .line-scroll-wrapper {
        white-space: nowrap;
        clear: both;
        overflow: hidden;
        zoom:1;
    }

    .line-normal-wrapper {
        display: inline-block;
        float: left;
        padding: 24px 0;
    }

    .line-btn-delete {
        text-align: center;
        background: #FF8383;
        color: #fff;
        width: 132px;
        font-size: 24px;
        height: 210px;
        line-height: 210px;
        display: inline-block;
        padding: 0 20px;
    }

    .line-btn-delete img {
        width: 30px;
        vertical-align: middle;
        margin-right: 10px;
    }

    .order-content {
        background-color: #fff;
        padding: 24px 48px;
    }

    .category-img {
        display: inline-block;
        width: 160px;
        height: 160px;
        margin: 0 10px 0 48px;
    }

    .order-detail, .order-num {
        display: inline-block;
        vertical-align: top;
        white-space: normal;
    }

    .order-detail {
        width: 65%;
    }

    .category-name {
        color: #000;
        font-size: 22px;
        line-height: 1.4;
        height: 45px;
        font-weight: bold;
        white-space: pre-line;
    }

    .category-subtitle {
        display: inline-block;
        line-height: 1.4;
        margin-right:12px;
        font-size: 20px;
    }

    .order-num {
        color: #999999;
        font-size: 22px;
        margin-right: 10px;
    }

    .num {
        float: right;
        margin-right: 48px;
    }

    .price {
        margin-top:5px;
        color: #FF5901;
    }

    .price-num {
        font-size: 30px;
    }

    .total {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        line-height: 2;
    }

    .total-name {
        color: #000;
        font-size: 16px;
    }

    .order-btn {
        border: none;
        width: 28%;
        line-height: 100px;
        border-radius: 8px;
        font-size: 30px;
        color: #fff;
    }

    .cancel {
        background-color: #64A4A9;
        margin: 0 5.4% 0 16%;
    }

    .buried {
        background-color: #FA875D;
        margin: 0 16% 0 5.4%;
    }

    .footer-btn {
        position: absolute;
        bottom: 60px;
        width: 100%;
    }

    /*推荐菜品弹出框btn*/
    .recommend-cancel, .recommend-buried {
        width: 38%;
        margin: 10% 5.8%;
    }

    .dialog {
        position: relative;
        display: none;
    }

    .dialog .dialog-wrapper {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        overflow: auto;
        backdrop-filter: blur(10px);
        opacity: 1;
        background: rgba(7, 17, 27, 0.8);
    }

    .dialog .dialog-main {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate3d(-50%, -50%, 0);
        width: 830px;
        max-height: 1200px;
        padding: 60px 20px 100px;
        box-sizing: border-box;
        background-color: #ffffff;
        border-radius: 8px;
        z-index: 102;
    }

    .recommend-title {
        text-align: center;
        font-size: 60px;
        color: #000;
        margin: 0 auto 10%;
    }

    .recommend-title span{
        border-bottom: 6px solid #FE6400;
        padding-bottom: 10px;
    }

    .recommend-img {
        width: 34%;
    }

    .recommend-category {
        display: inline-block;
        width: 64%;
        float: right;
    }

    .recommend-name {
        height: 48px;
        overflow: hidden;
    }

    .recommend-price {
        text-align: right;
    }

    .recommend-li {
        margin-bottom: 110px;
    }

    .food-num {
        position: relative;
        margin-top: 20px;
        text-align: right;
    }

    .food-num .fab-reduce, .food-num .fab-add {
        display: inline-block;
        font-size: 35px;
        line-height: 30px;
        text-align: center;
        color: #FF5901;
        transition: all 0.4s linear;
        opacity: 1;
        box-sizing: border-box;
        vertical-align: middle;
        position: absolute;
        right: 0;
    }

    .food-num .fab-reduce {
        color: #999999;
        right: 70px;
        transform: translate3d(50px, 0, 0);
        opacity: 0;
    }

    .food-num .num-text {
        width: 20px;
        height: 30px;
        line-height: 30px;
        font-size: 28px;
        text-align: center;
        display: none;
        vertical-align: middle;
        position: absolute;
        right: 45px;

    }

    .list-ul::-webkit-scrollbar {
        display: none;
    }

    .fab-add, .fab-reduce {
        display: inline-block;
        font-size: 26px;
    }

    .swal2-modal{
        width: auto !important;
        left: 15%;
        right: 15%;
        top:30%;
        margin-left: 0 !important;
    }
    .swal2-modal .swal2-image{
        margin:5% auto 10%;
    }
    .swal2-content{
        margin-bottom:50px;
        font-size:36px;
    }
    .swal2-modal button.styled{
        width:40%;
        height: 90px;
        line-height: 90px;
        font-size:32px;
    }
    .swal2-confirm{
        background-color: #FA875D !important;
    }

</style>

<script type="text/javascript">
    // 滑动删除
    $(document).ready(function (e) {
        // 设定每一行的宽度=屏幕宽度+按钮宽度
        $(".line-scroll-wrapper").width($(".line-wrapper").width() + $(".line-btn-delete").width());
        // 设定常规信息区域宽度=屏幕宽度
        $(".line-normal-wrapper").width($(".line-wrapper").width());
        // 设定文字部分宽度（为了实现文字过长时在末尾显示...）
        $(".line-normal-msg").width($(".line-normal-wrapper").width() - 280);

        // 获取所有行，对每一行设置监听
        var lines = $(".line-normal-wrapper");
        var len = lines.length;
        var lastX, lastXForMobile;

        // 用于记录被按下的对象
        var pressedObj;  // 当前左滑的对象
        var lastLeftObj; // 上一个左滑的对象

        // 用于记录按下的点
        var start;

        // 网页在移动端运行时的监听
        for (var i = 0; i < len; ++i) {
            lines[i].addEventListener('touchstart', function (e) {
                lastXForMobile = e.changedTouches[0].pageX;
                pressedObj = this; // 记录被按下的对象

                // 记录开始按下时的点
                var touches = event.touches[0];
                start = {
                    x: touches.pageX, // 横坐标
                    y: touches.pageY  // 纵坐标
                };
            });

            lines[i].addEventListener('touchmove', function (e) {
                // 计算划动过程中x和y的变化量
                var touches = event.touches[0];
                delta = {
                    x: touches.pageX - start.x,
                    y: touches.pageY - start.y
                };

                // 横向位移大于纵向位移，阻止纵向滚动
                if (Math.abs(delta.x) > Math.abs(delta.y)) {
                    event.preventDefault();
                }
            });

            lines[i].addEventListener('touchend', function (e) {
                if (lastLeftObj && pressedObj != lastLeftObj) { // 点击除当前左滑对象之外的任意其他位置
                    $(lastLeftObj).animate({marginLeft: "0"}, 300); // 右滑
                    lastLeftObj = null; // 清空上一个左滑的对象
                }
                var diffX = e.changedTouches[0].pageX - lastXForMobile;
                if (diffX < -150) {
                    $(pressedObj).animate({marginLeft: "-132px"}, 300); // 左滑
                    lastLeftObj && lastLeftObj != pressedObj &&
                    $(lastLeftObj).animate({marginLeft: "0"}, 300); // 已经左滑状态的按钮右滑
                    lastLeftObj = pressedObj; // 记录上一个左滑的对象
                } else if (diffX > 150) {
                    if (pressedObj == lastLeftObj) {
                        $(pressedObj).animate({marginLeft: "0"}, 300); // 右滑
                        lastLeftObj = null; // 清空上一个左滑的对象
                    }
                }
            });
        }

        // 网页在PC浏览器中运行时的监听
        for (var i = 0; i < len; ++i) {
            $(lines[i]).bind('mousedown', function (e) {
                lastX = e.clientX;
                pressedObj = this; // 记录被按下的对象
            });

            $(lines[i]).bind('mouseup', function (e) {
                if (lastLeftObj && pressedObj != lastLeftObj) { // 点击除当前左滑对象之外的任意其他位置
                    $(lastLeftObj).animate({marginLeft: "0"}, 300); // 右滑
                    lastLeftObj = null; // 清空上一个左滑的对象
                }
                var diffX = e.clientX - lastX;
                if (diffX < -150) {
                    $(pressedObj).animate({marginLeft: "-132px"}, 300); // 左滑
                    lastLeftObj && lastLeftObj != pressedObj &&
                    $(lastLeftObj).animate({marginLeft: "0"}, 300); // 已经左滑状态的按钮右滑
                    lastLeftObj = pressedObj; // 记录上一个左滑的对象
                } else if (diffX > 150) {
                    if (pressedObj == lastLeftObj) {
                        $(pressedObj).animate({marginLeft: "0"}, 300); // 右滑
                        lastLeftObj = null; // 清空上一个左滑的对象
                    }
                }
            });
        }
    });
    // 推荐菜品弹出
    window.onload = function () {
        // $(".dialog").fadeIn();
    };
    //弹出菜品关闭
    $(".dialog-wrapper,.recommend-cancel,.recommend-buried").on("click", function () {
        $(".dialog").fadeOut();
    });

    //埋单
    $(".order-buried").on("click", function () {
        window.location.href = 'takemeal.html';
    });

    //取消订单
    $(".order-cancel").on("click", function () {
        window.location.href = 'index.html';
    });

    // 推荐菜品数量添加
    $(".fab-add").on("click", function () {
        var num = $(this).prev(".num-text").text();
        num++;
        $(this).siblings("i").css({
            transform: 'translate3d(0,0,0)',
            opacity: 1
        });
        $(this).prev(".num-text").text(num).css("display", "inline-block");
    });

    //推荐菜品数量减少
    $('.fab-reduce').on('click', function () {
        var num = parseInt($(this).next('.num-text').text());
        if (num >1) {
            num--;
            $(this).next('.num-text').text(num);
        } else {
            $(this).css({
                transform: 'translate3d(50px,0,0)',
                opacity: 0
            });
            num = 0;
            $(this).next('.num-text').text(num);
            $(this).next('.num-text').css('display', 'none');
        }
    });

    //删除订单
    function orderDel(orderSN){
        swal({
            text:"確定要刪除訂單嗎？",
            showCancelButton: true,
            confirmButtonColor: "#FA875D",
            imageUrl:"STATIC_PATH/assets/mobile/images/a-delete.png",
            confirmButtonText: "確認",
            cancelButtonText: "取消",
            closeOnConfirm: false,
            closeOnCancel: false
        }).then(function (isConfirm) {
            if(isConfirm){
                $.ajax({
                    type: "POST",
                    url : "{:url('index/deleteCart')}",
                    data: {'orderSN':orderSN},async: true,
                    success: function(data) {
                        if (data.code) {
                            window.location.href = "{:url('index/payorder')}";
                        }
                    },
                    error: function(request) {
                        closeloading();
                        swal({
                            'text':'操作失敗',
                            'confirmButtonText': '確認',
                            'confirmButtonColor':'#e07a0a',
                            'imageUrl': 'STATIC_PATH/assets/mobile/images/error-img.png',
                            'imageSize': '16x16',
                            'customClass': 'fail'
                        });
                    }
                });
            }
        });
    }

   /* $(".line-btn-delete").on("click", function () {
        /!*var r = confirm("是否删除订单？");
        if (r==true) {
            alert("确认删除！");
        } else {
            alert("取消删除！");
        }*!/

    });*/

</script>
</body>
</html>
